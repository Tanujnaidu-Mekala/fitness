<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Goal-Based Plan Selector - TLA</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800;900&family=Roboto+Condensed:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="shortcut icon" type="image/jpeg" href="logo.jpg" />
    <style>
        /* All existing CSS styles remain unchanged */
        :root {
            --bg-dark: #000000;
            --bg-darker: #050505;
            --bg-lighter: #1A1A1A;
            --text-primary: #FFFFFF;
            --text-secondary: #B0B0B0;
            --text-muted: #666666;
            --border-subtle: rgba(0, 255, 255, 0.15);
            --accent-color: #00FFFF;
            --primary-gradient: linear-gradient(135deg, var(--accent-color) 0%, #0099CC 100%);
            --secondary-gradient: linear-gradient(135deg, var(--accent-orange) 0%, #F7931E 100%);
            --accent-gradient: linear-gradient(135deg, var(--accent-pink) 0%, #C77DFF 100%);
            --accent-orange: #FF6B35;
            --accent-pink: #F72585;
            --recovery-color: #28a745;
            --fatigue-color: #ffc107;
            --danger-color: #ff4d4d;
            --bear-color: #8B4513;
            --lion-color: #DAA520;
            --cheetah-color: #FFA500;
            --eagle-color: #4682B4;
            --wolf-color: #696969;
            --tiger-color: #FF8C00;
            --gorilla-color: #4B0082;
            --shark-color: #00CED1;
            --rest-color: #555555;
            --error-color: #ff4d4d;
            --health-restriction-color: #ff0000;
            --health-restriction-bg: rgba(255, 0, 0, 0.15);
            --health-restriction-border: #ff0000;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        html {
            scroll-behavior: smooth;
        }
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-primary);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            overflow-x: hidden;
            min-height: 100vh;
            cursor: none !important;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }
        /* Loading Screen - From First Code */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: var(--bg-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10001;
            transition: opacity 0.5s ease-out;
        }
        .loading-container {
            text-align: center;
            position: relative;
            width: 100%;
            max-width: 500px;
        }
        .loading-animation {
            position: relative;
            width: 200px;
            height: 200px;
            margin: 0 auto 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .loading-icon {
            font-size: 3rem;
            color: var(--accent-color);
            animation: pulse-grow 1.5s ease-in-out infinite;
            position: relative;
            z-index: 1;
        }
        .loading-circle {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 3px solid transparent;
            border-top-color: var(--accent-color);
            transform: rotate(0deg);
            animation: spin 1.5s cubic-bezier(0.68, -0.55, 0.27, 1.55) infinite;
        }
        .loading-circle::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 10px;
            height: 10px;
            background: var(--accent-color);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 10px var(--accent-color);
        }
        .loading-circle-alt {
            position: absolute;
            width: 80%;
            height: 80%;
            border-radius: 50%;
            border: 3px solid transparent;
            border-bottom-color: var(--accent-pink);
            transform: rotate(0deg) scale(0.8);
            animation: spin-reverse 1.2s cubic-bezier(0.68, -0.55, 0.27, 1.55) infinite;
        }
        .loading-text h2 {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: 2px;
            font-family: 'Montserrat', sans-serif;
        }
        .loading-text p {
            color: var(--text-secondary);
            font-style: italic;
            margin-bottom: 2rem;
            font-size: 1.2rem;
            font-family: 'Montserrat', sans-serif;
        }
        .loading-progress {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        .loading-bar {
            width: 8px;
            height: 30px;
            background: var(--primary-gradient);
            border-radius: 4px;
            animation: loadingPulse 1.4s ease-in-out infinite;
        }
        .loading-bar:nth-child(2) { animation-delay: 0.2s; background: var(--secondary-gradient); }
        .loading-bar:nth-child(3) { animation-delay: 0.4s; background: var(--accent-gradient); }
        .loading-bar:nth-child(4) { animation-delay: 0.6s; background: var(--primary-gradient); }
        .loading-bar:nth-child(5) { animation-delay: 0.8s; background: var(--secondary-gradient); }
        /* Enhanced Cursor */
        .custom-cursor {
            position: fixed;
            width: 40px;
            height: 40px;
            z-index: 99999;
            pointer-events: none;
            transform: translate(-50%, -50%);
            transition: transform 0.1s ease;
        }
        .dumbbell-cursor {
            font-size: 40px;
            color: var(--accent-color);
            animation: rotate 3s linear infinite;
            filter: drop-shadow(0 0 15px rgba(0, 255, 255, 0.9));
        }
        /* Dynamic Background */
        #particle-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -10;
        }
        #ambient-glow {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
            z-index: 9999;
            background: radial-gradient(circle at var(--x) var(--y), rgba(0, 255, 255, 0.15) 0%, transparent 40%);
            transition: background 0.1s ease-out;
        }
        /* Smash Effects - From First Code */
        .smash-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10000;
        }
        .smash-particle {
            position: absolute;
            font-size: 16px;
            pointer-events: none;
            animation: smash 0.8s ease-out forwards;
            filter: drop-shadow(0 0 6px rgba(0, 255, 255, 0.7));
        }
        .glass-break {
            position: absolute;
            pointer-events: none;
            animation: glassBreak 0.8s ease-out forwards;
        }
        .glass-shard {
            position: absolute;
            background: linear-gradient(45deg, rgba(255, 255, 255, 0.8), rgba(0, 255, 255, 0.5));
            pointer-events: none;
            animation: shardFly 1s ease-out forwards;
            box-shadow: 0 0 8px rgba(0, 255, 255, 0.7);
        }
        /* Header */
        header {
            position: fixed;
            top: 0;
            width: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(20px);
            z-index: 1000;
            padding: 0 24px;
            opacity: 0;
            transform: translateY(-100%);
            animation: slideDown 0.8s ease 3.5s forwards;
            border-bottom: 1px solid var(--border-subtle);
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        header.scrolled {
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(30px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        .header-content {
            max-width: 1600px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 80px;
        }
        .logo {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--text-primary);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            letter-spacing: 1px;
            transition: transform 0.3s ease;
        }
        .logo:hover { transform: scale(1.05); }
        .logo-icon {
            width: 2.5rem;
            height: 2.5rem;
            color: var(--accent-color);
            animation: pulse 2s infinite;
        }
        .header-nav {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        /* Profile Dropdown - From First Code */
        .profile-dropdown { position: relative; }
        .profile-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            background: var(--primary-gradient);
            border: none;
            border-radius: 50px;
            color: var(--bg-dark);
            font-size: 0.95rem;
            font-weight: 600;
            cursor: none;
            transition: all 0.3s ease;
            font-family: 'Montserrat', sans-serif;
        }
        .profile-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 255, 255, 0.4);
        }
        .profile-avatar {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--bg-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--accent-color);
        }
        .dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 0.5rem;
            background: rgba(26, 26, 26, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            overflow: hidden;
            min-width: 200px;
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            pointer-events: none;
            z-index: 1000;
        }
        .dropdown-menu.active {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }
        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            color: var(--text-secondary);
            text-decoration: none;
            transition: all 0.2s ease;
            font-family: 'Montserrat', sans-serif;
        }
        .dropdown-item:hover {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
        }
        .dropdown-item i { width: 16px; text-align: center; }
        .dropdown-divider {
            height: 1px;
            background: var(--border-subtle);
            margin: 0.5rem 0;
        }
        
        .btn, .btn-secondary, .btn-primary {
            font-family: 'Roboto Condensed', sans-serif;
            font-weight: 700;
            padding: 12px 28px;
            border-radius: 50px;
            text-decoration: none;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            text-transform: uppercase;
            letter-spacing: 1px;
            border: none;
            position: relative;
            overflow: hidden;
            cursor: none;
        }
        .btn:hover, .btn-secondary:hover, .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 255, 255, 0.5);
        }
        .btn:active, .btn-secondary:active, .btn-primary:active {
            transform: translateY(0px) scale(0.98);
            box-shadow: 0 4px 15px rgba(0, 255, 255, 0.6);
        }
        
        .btn-primary {
            background: var(--primary-gradient);
            color: var(--bg-dark);
        }
        .btn-primary:disabled {
             background: var(--text-muted);
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }
        .btn-secondary {
            background: transparent;
            color: var(--accent-color);
            border: 2px solid var(--accent-color);
        }
        .btn-secondary:hover {
            background: var(--accent-color);
            color: var(--bg-dark);
        }
        /* Plan Selector Wizard */
        .plan-selector-wizard {
            padding: 150px 0 60px;
            min-height: 100vh;
        }
        .wizard-header {
            text-align: center;
            margin-bottom: 4rem;
        }
        .wizard-header h1 {
            font-size: clamp(2.5rem, 6vw, 4rem);
            font-weight: 900;
            margin-bottom: 1rem;
            background: linear-gradient(90deg, var(--text-primary), var(--accent-color), var(--text-primary));
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: 2px;
            font-family: 'Montserrat', sans-serif;
        }
        .wizard-header p {
            font-size: 1.125rem;
            color: var(--text-secondary);
            max-width: 800px;
            margin: 0 auto;
            animation: fadeInUp 0.8s ease 0.2s forwards;
            opacity: 0;
        }
        .wizard-container {
            background: rgba(15, 15, 15, 0.7);
            backdrop-filter: blur(15px);
            border: 1px solid var(--border-subtle);
            border-radius: 20px;
            padding: 40px;
            max-width: 900px;
            margin: 0 auto;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            animation: fadeInUp 0.8s ease 0.4s forwards;
            opacity: 0;
        }
        
        .progress-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2.5rem;
            position: relative;
        }
        .progress-bar::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            transform: translateY(-50%);
            height: 2px;
            width: 100%;
            background: var(--border-subtle);
            z-index: -1;
        }
        .progress-line {
            position: absolute;
            top: 50%;
            left: 0;
            transform: translateY(-50%);
            height: 2px;
            background: var(--accent-color);
            transition: width 0.5s ease;
        }
        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-muted);
            transition: color 0.5s ease;
        }
        .step.active {
            color: var(--accent-color);
        }
        .step-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid var(--border-subtle);
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-dark);
            transition: all 0.5s ease;
        }
        .step.active .step-icon {
            background: var(--accent-color);
            color: var(--bg-dark);
            border-color: var(--accent-color);
            transform: scale(1.1);
        }
        .step.completed .step-icon {
            background: var(--accent-color);
            color: var(--bg-dark);
            border-color: var(--accent-color);
        }
        .wizard-step { animation: fadeIn 0.5s ease; }
        .wizard-step h2 {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 2rem;
            color: var(--accent-color);
            text-align: center;
        }
        
        .selection-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
        }
        .selection-card {
            background: var(--bg-lighter);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .selection-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent-color);
            box-shadow: 0 10px 30px rgba(0, 255, 255, 0.2);
        }
        .selection-card.selected {
            border-color: var(--accent-color);
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.5), inset 0 0 25px rgba(0, 255, 255, 0.4);
            background: linear-gradient(rgba(0,255,255,0.15), transparent);
            transform: translateY(-5px) scale(1.02);
        }
        .selection-card i {
            font-size: 3rem;
            color: var(--accent-color);
            margin-bottom: 1rem;
            transition: transform 0.3s ease;
        }
        .selection-card:hover i { transform: scale(1.1); }
        .selection-card h3 {
            font-size: 1.2rem;
            color: var(--text-primary);
        }
        .biometrics-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        .input-group label {
            font-weight: 600;
            color: var(--text-secondary);
        }
        .input-group input, .input-group select {
            width: 100%;
            padding: 12px 20px;
            font-size: 1rem;
            background-color: var(--bg-dark);
            color: var(--text-primary);
            border: 1px solid var(--border-subtle);
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        .input-group input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.7);
            transform: scale(1.02);
        }
        .height-inputs { display: flex; gap: 10px; }
        .error-message { color: var(--error-color); font-size: 0.9rem; margin-top: 5px; }
        .input-group.error input {
            border-color: var(--error-color);
            animation: error-glow 0.5s ease-in-out;
        }
        .wizard-nav {
            display: flex;
            justify-content: space-between;
            margin-top: 3rem;
        }
        
        /* Body Type Selection */
        .body-type-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 10px;
        }
        
        .body-type-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: var(--bg-dark);
            border: 2px solid var(--border-subtle);
            border-radius: 12px;
            padding: 15px;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transform: perspective(500px) rotateX(0);
            transform-style: preserve-3d;
        }
        
        .body-type-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--accent-gradient);
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 0;
        }
        
        .body-type-option:hover {
            border-color: var(--accent-pink);
            box-shadow: 0 8px 25px rgba(247, 37, 133, 0.4);
            transform: translateY(-5px) perspective(500px) rotateX(5deg);
        }
        
        .body-type-option:hover::before {
            opacity: 0.1;
        }
        
        .body-type-option input[type="radio"] {
            display: none;
        }
        
        .body-type-option.selected {
            border-color: var(--accent-pink);
            background-color: rgba(247, 37, 133, 0.1);
            box-shadow: 0 8px 25px rgba(247, 37, 133, 0.4);
        }
        
        .body-type-option.selected::before {
            opacity: 0.2;
        }
        
        .body-type-option .body-model {
            width: 150px;
            height: 200px;
            margin-bottom: 5px;
            position: relative;
            z-index: 1;
            object-fit: cover;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .body-type-option:hover .body-model {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(247, 37, 133, 0.5);
        }
        
        .body-type-option span {
            font-size: 0.9rem;
            color: var(--text-primary);
            text-align: center;
            position: relative;
            z-index: 1;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .body-type-option.selected span {
            color: var(--accent-pink);
            font-weight: 700;
            text-shadow: 0 0 10px rgba(247, 37, 133, 0.5);
        }
        
        /* Fitness Level Description */
        .fitness-description {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 10px;
            padding: 15px;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            border-left: 3px solid var(--accent-color);
            transition: all 0.3s ease;
        }
        
        .fitness-description:hover {
            background-color: rgba(0, 255, 255, 0.05);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.1);
            transform: translateY(-2px);
        }
        
        .fitness-level-item {
            margin-bottom: 10px;
            padding-left: 20px;
            position: relative;
        }
        
        .fitness-level-item:before {
            content: 'â€¢';
            position: absolute;
            left: 0;
            color: var(--accent-color);
        }
        
        /* Equipment Selection Styles - From First Code */
        .equipment-options {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .equipment-option {
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--bg-dark);
            border: 2px solid var(--border-subtle);
            border-radius: 12px;
            padding: 15px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            cursor: pointer;
            height: 60px;
            transform: perspective(500px) rotateX(0);
            transform-style: preserve-3d;
        }
        
        .equipment-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 0;
            height: 100%;
            background: var(--primary-gradient);
            opacity: 0.2;
            transition: width 0.5s ease;
            z-index: 0;
            transform-origin: left;
        }
        
        .equipment-option:hover {
            border-color: var(--accent-color);
            box-shadow: 0 8px 25px rgba(0, 255, 255, 0.3);
            transform: translateY(-5px) perspective(500px) rotateX(5deg);
        }
        
        .equipment-option:hover::before {
            width: 100%;
        }
        
        .equipment-option input[type="checkbox"] {
            display: none;
        }
        
        .equipment-option label {
            margin: 0;
            cursor: pointer;
            font-size: 0.95rem;
            text-transform: none;
            letter-spacing: normal;
            color: var(--text-primary);
            font-weight: 500;
            position: relative;
            z-index: 1;
            transition: all 0.3s ease;
        }
        
        .equipment-option.selected {
            border-color: var(--accent-color);
            background-color: rgba(0, 255, 255, 0.1);
            box-shadow: 0 8px 25px rgba(0, 255, 255, 0.3);
            animation: pulse-glow 2s infinite;
        }
        
        .equipment-option.selected::before {
            width: 100%;
        }
        
        .equipment-option.selected label {
            color: var(--accent-color);
            font-weight: 700;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }
        
        /* Workout Mode Selection Styles - From First Code */
        .workout-mode-options {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            justify-content: center;
        }
        
        .workout-mode-option {
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--bg-dark);
            border: 2px solid var(--border-subtle);
            border-radius: 12px;
            padding: 15px 30px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            cursor: pointer;
            transform: perspective(500px) rotateX(0);
            transform-style: preserve-3d;
        }
        
        .workout-mode-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 0;
            height: 100%;
            background: var(--secondary-gradient);
            opacity: 0.2;
            transition: width 0.5s ease;
            z-index: 0;
            transform-origin: left;
        }
        
        .workout-mode-option:hover {
            border-color: var(--accent-orange);
            box-shadow: 0 8px 25px rgba(255, 107, 53, 0.3);
            transform: translateY(-5px) perspective(500px) rotateX(5deg);
        }
        
        .workout-mode-option:hover::before {
            width: 100%;
        }
        
        .workout-mode-option input[type="radio"] {
            display: none;
        }
        
        .workout-mode-option label {
            margin: 0;
            cursor: pointer;
            font-size: 1rem;
            text-transform: none;
            letter-spacing: normal;
            color: var(--text-primary);
            font-weight: 500;
            position: relative;
            z-index: 1;
            transition: all 0.3s ease;
        }
        
        .workout-mode-option.selected {
            border-color: var(--accent-orange);
            background-color: rgba(255, 107, 53, 0.1);
            box-shadow: 0 8px 25px rgba(255, 107, 53, 0.3);
            animation: pulse-glow-sub 2s infinite;
        }
        
        .workout-mode-option.selected::before {
            width: 100%;
        }
        
        .workout-mode-option.selected label {
            color: var(--accent-orange);
            font-weight: 700;
            text-shadow: 0 0 10px rgba(255, 107, 53, 0.5);
        }
        
        /* Dietary Options Styles - From First Code */
        .dietary-options {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .dietary-option-container {
            position: relative;
            z-index: 1;
        }
        
        .dietary-option {
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--bg-dark);
            border: 2px solid var(--border-subtle);
            border-radius: 12px;
            padding: 15px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            cursor: pointer;
            height: 60px;
            transform: perspective(500px) rotateX(0);
            transform-style: preserve-3d;
            padding-right: 60px; /* Make room for toggle block */
        }
        
        .dietary-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 0;
            height: 100%;
            background: var(--primary-gradient);
            opacity: 0.2;
            transition: width 0.5s ease;
            z-index: 0;
            transform-origin: left;
        }
        
        .dietary-option:hover {
            border-color: var(--accent-color);
            box-shadow: 0 8px 25px rgba(0, 255, 255, 0.3);
            transform: translateY(-5px) perspective(500px) rotateX(5deg);
        }
        
        .dietary-option:hover::before {
            width: 100%;
        }
        
        .dietary-option input[type="checkbox"] {
            display: none;
        }
        
        .dietary-option label {
            margin: 0;
            cursor: pointer;
            font-size: 0.95rem;
            text-transform: none;
            letter-spacing: normal;
            color: var(--text-primary);
            font-weight: 500;
            position: relative;
            z-index: 1;
            transition: all 0.3s ease;
        }
        
        .dietary-option.selected {
            border-color: var(--accent-color);
            background-color: rgba(0, 255, 255, 0.1);
            box-shadow: 0 8px 25px rgba(0, 255, 255, 0.3);
            animation: pulse-glow 2s infinite;
        }
        
        .dietary-option.selected::before {
            width: 100%;
        }
        
        .dietary-option.selected label {
            color: var(--accent-color);
            font-weight: 700;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }
        
        /* Toggle Block for Dietary Options */
        .dietary-toggle-block {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            width: 40px;
            height: 40px;
            background-color: rgba(0, 255, 255, 0.1);
            border: 1px solid var(--border-subtle);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 2;
        }
        .dietary-toggle-block:hover {
            background-color: rgba(0, 255, 255, 0.2);
            border-color: var(--accent-color);
        }
        .dietary-toggle-block i {
            transition: transform 0.3s ease;
            color: var(--text-secondary);
        }
        .dietary-toggle-block i.rotated {
            transform: rotate(180deg);
        }
        
        /* Dietary Sub-options Styles - From First Code */
        .dietary-sub-options {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 15px;
            margin-top: 15px;
            padding: 20px;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            border: 1px solid var(--border-subtle);
            max-height: 300px;
            overflow-y: auto;
            overflow-x: hidden;
            opacity: 0;
            transform: translateY(-10px);
            transition: max-height 0.5s ease, opacity 0.5s ease, transform 0.5s ease;
            z-index: 10;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            position: relative;
        }
        
        .dietary-sub-options.active {
            display: grid;
            opacity: 1;
            transform: translateY(0);
            animation: slideDown 0.5s ease forwards;
        }
        
        .dietary-sub-option {
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--bg-dark);
            border: 2px solid var(--border-subtle);
            border-radius: 12px;
            padding: 12px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            cursor: pointer;
            height: 50px;
            transform: perspective(500px) rotateX(0);
            transform-style: preserve-3d;
        }
        
        .dietary-sub-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 0;
            height: 100%;
            background: var(--secondary-gradient);
            opacity: 0.2;
            transition: width 0.5s ease;
            z-index: 0;
            transform-origin: left;
        }
        
        .dietary-sub-option:hover {
            border-color: var(--accent-orange);
            box-shadow: 0 8px 25px rgba(255, 107, 53, 0.3);
            transform: translateY(-5px) perspective(500px) rotateX(5deg);
        }
        
        .dietary-sub-option:hover::before {
            width: 100%;
        }
        
        .dietary-sub-option input[type="checkbox"] {
            display: none;
        }
        
        .dietary-sub-option label {
            margin: 0;
            cursor: pointer;
            font-size: 0.9rem;
            text-transform: none;
            letter-spacing: normal;
            color: var(--text-primary);
            font-weight: 500;
            position: relative;
            z-index: 1;
            transition: all 0.3s ease;
        }
        
        .dietary-sub-option.selected {
            border-color: var(--accent-orange);
            background-color: rgba(255, 107, 53, 0.1);
            box-shadow: 0 8px 25px rgba(255, 107, 53, 0.3);
            animation: pulse-glow-sub 2s infinite;
        }
        
        .dietary-sub-option.selected label {
            color: var(--accent-orange);
            font-weight: 700;
            text-shadow: 0 0 10px rgba(255, 107, 53, 0.5);
        }
        
        /* Health restriction style - From First Code */
        .dietary-sub-option.health-restriction {
            border: 4px solid var(--health-restriction-border);
            background-color: var(--health-restriction-bg);
            box-shadow: 0 0 30px rgba(255, 0, 0, 7), inset 0 0 20px rgba(255, 0, 0, 0.3);
            animation: health-restriction-pulse 2s infinite;
            height: auto;
            min-height: 280px;
            max-height: none;
            padding: 20px;
            position: relative;
            overflow: visible;
            z-index: 20;
            transform: scale(1.02);
            grid-column: 1 / -1;
            width: 100%;
            max-width: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .dietary-sub-option.health-restriction::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 10px,
                rgba(255, 0, 0, 0.2) 10px,
                rgba(255, 0, 0, 0.2) 20px
            );
            z-index: 0;
            border-radius: 9px;
            animation: health-restriction-bg-pulse 3s infinite;
        }
        
        .dietary-sub-option.health-restriction::after {
            content: '\f071';
            font-family: 'Font Awesome 5 Free';
            font-weight: 900;
            position: absolute;
            top: -15px;
            right: -15px;
            background-color: var(--health-restriction-color);
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            z-index: 2;
            box-shadow: 0 0 20px rgba(255, 0, 0, 0.9);
            animation: warning-icon-pulse 1.5s infinite;
        }
        
        .dietary-sub-option.health-restriction label {
            color: var(--health-restriction-color);
            font-weight: 800;
            text-shadow: 0 0 12px rgba(255, 0, 0, 1);
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
            font-size: 1rem;
            flex-shrink: 0;
        }
        
        .health-restriction-desc {
            font-size: 0.95rem;
            color: var(--health-restriction-color);
            margin-top: 0;
            text-align: center;
            padding: 15px;
            background-color: rgba(0, 0, 0, 0.7);
            border-radius: 12px;
            border: 2px dashed rgba(255, 0, 0, 0.7);
            width: 100%;
            position: relative;
            z-index: 1;
            line-height: 1.6;
            font-weight: 600;
            box-shadow: 0 0 15px rgba(255, 0, 0, 0.4);
            max-height: none;
            overflow: visible;
            height: auto;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
        }
        
        /* Health warning message - From First Code */
        .health-warning-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #2c0505, #4a0909);
            border: 3px solid #ff0000;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 0 40px rgba(255, 0, 0, 0.8), inset 0 0 20px rgba(255, 0, 0, 0.3);
            z-index: 10000;
            max-width: 450px;
            text-align: center;
            animation: warning-message-appear 0.5s ease-out;
        }
        
        .health-warning-message h3 {
            color: #ff4d4d;
            font-size: 1.5rem;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 800;
            text-shadow: 0 0 10px rgba(255, 77, 77, 0.8);
        }
        
        .health-warning-message p {
            color: #ffffff;
            font-size: 1rem;
            margin-bottom: 20px;
            line-height: 1.5;
        }
        
        .health-warning-message button {
            background: linear-gradient(135deg, #ff4d4d, #cc0000);
            color: white;
            border: none;
            border-radius: 30px;
            padding: 10px 25px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 5px 15px rgba(255, 0, 0, 0.5);
        }
        
        .health-warning-message button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 0, 0, 0.7);
        }
        
        /* Health Issues Options Styles - From First Code */
        .health-issues-options {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 15px;
            margin-top: 15px;
            padding: 20px;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            border: 1px solid var(--border-subtle);
            display: none;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease, opacity 0.5s ease, transform 0.5s ease;
            opacity: 0;
            transform: translateY(-10px);
            z-index: 5;
        }
        
        .health-issues-options.active {
            display: grid;
            max-height: 600px;
            overflow-y: auto;
            opacity: 1;
            transform: translateY(0);
            animation: slideDown 0.5s ease forwards;
        }
        
        .health-issue-option {
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--bg-dark);
            border: 2px solid var(--border-subtle);
            border-radius: 12px;
            padding: 12px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            cursor: pointer;
            height: 50px;
            transform: perspective(500px) rotateX(0);
            transform-style: preserve-3d;
        }
        
        .health-issue-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 0;
            height: 100%;
            background: var(--danger-color);
            opacity: 0.2;
            transition: width 0.5s ease;
            z-index: 0;
            transform-origin: left;
        }
        
        .health-issue-option:hover {
            border-color: var(--danger-color);
            box-shadow: 0 8px 25px rgba(255, 77, 77, 0.3);
            transform: translateY(-5px) perspective(500px) rotateX(5deg);
        }
        
        .health-issue-option:hover::before {
            width: 100%;
        }
        
        .health-issue-option input[type="checkbox"] {
            display: none;
        }
        
        .health-issue-option label {
            margin: 0;
            cursor: pointer;
            font-size: 0.9rem;
            text-transform: none;
            letter-spacing: normal;
            color: var(--text-primary);
            font-weight: 500;
            position: relative;
            z-index: 1;
            transition: all 0.3s ease;
        }
        
        .health-issue-option.selected {
            border-color: var(--danger-color);
            background-color: rgba(255, 77, 77, 0.1);
            box-shadow: 0 8px 25px rgba(255, 77, 77, 0.3);
        }
        
        .health-issue-option.selected label {
            color: var(--danger-color);
            font-weight: 700;
            text-shadow: 0 0 10px rgba(255, 77, 77, 0.5);
        }
        
        /* Log Plan Section */
        .log-plan-section {
            text-align: center;
            padding: 40px 20px;
            background: rgba(15, 15, 15, 0.7);
            backdrop-filter: blur(15px);
            border: 1px solid var(--border-subtle);
            border-radius: 20px;
            margin-top: 20px;
            margin-bottom: 40px;
            animation: fadeInUp 0.8s ease;
        }
        .log-plan-section h3 {
            font-size: 2rem;
            color: var(--accent-color);
            margin-bottom: 1rem;
        }
        .log-plan-section p {
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
        }
        .log-plan-section button.logged-animation {
            animation: log-success 0.5s ease-in-out;
        }
        /* History Modal */
        .history-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        .history-modal-overlay.visible {
            opacity: 1;
            pointer-events: auto;
        }
        .history-modal {
            background: var(--bg-darker);
            border: 1px solid var(--border-subtle);
            border-radius: 15px;
            width: 90%;
            max-width: 1000px;
            height: 80vh;
            display: flex;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.6);
            transform: scale(0.95);
            transition: transform 0.3s ease;
        }
        .history-modal-overlay.visible .history-modal {
            transform: scale(1);
        }
        .history-list {
            width: 35%;
            border-right: 1px solid var(--border-subtle);
            overflow-y: auto;
        }
        .history-list-item {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border-subtle);
            cursor: none;
            transition: background 0.2s ease;
        }
        .history-list-item:hover { background: rgba(255,255,255,0.05); }
        .history-list-item.selected { background: rgba(0,255,255,0.1); }
        .history-list-item h4 { color: var(--accent-color); margin-bottom: 0.25rem; }
        .history-list-item p { font-size: 0.8rem; color: var(--text-secondary); }
        
        .history-details {
            width: 65%;
            padding: 2rem;
            overflow-y: auto;
        }
        .history-details-content {
            animation: fadeIn 0.5s ease;
        }
        .history-details h2 {
            font-size: 1.8rem;
            color: var(--accent-color);
            margin-bottom: 1.5rem;
        }
        .history-close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 1.5rem;
        }
        /* Generated Plan */
        #generated-plan {
            text-align: left;
            animation: fadeIn 1s ease 0.5s forwards;
            opacity: 1; /* Changed from 0 to 1 to ensure visibility */
        }
        .plan-section {
            background: rgba(25, 25, 25, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-subtle);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 40px;
            position: relative;
            overflow: hidden;
            transition: transform 0.4s ease, box-shadow 0.4s ease, border-color 0.4s ease;
            opacity: 1; /* Changed from 0 to 1 to ensure visibility */
            transform: translateY(0); /* Changed from 50px to 0 */
        }
        .plan-section.visible {
            opacity: 1;
            transform: translateY(0);
            transition: opacity 0.6s ease, transform 0.6s ease;
        }
        #generated-plan > .plan-section.visible:nth-of-type(1) { transition-delay: 0.2s; }
        #generated-plan > .plan-section.visible:nth-of-type(2) { transition-delay: 0.4s; }
        #generated-plan > .plan-section.visible:nth-of-type(3) { transition-delay: 0.6s; }
        .plan-section:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 255, 255, 0.2);
            border-color: rgba(0, 255, 255, 0.5);
        }
        .plan-section h2 {
            font-family: 'Roboto Condensed', sans-serif;
            font-size: 2rem;
            color: var(--accent-color);
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 2px solid var(--border-subtle);
            padding-bottom: 15px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .plan-section h2 i { animation: icon-float 3s ease-in-out infinite; }
        .section-logo {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 3rem;
            color: var(--accent-color);
            opacity: 0.3;
            transition: all 0.5s ease;
            z-index: 1;
            animation: float 4s ease-in-out infinite;
        }
        .plan-section:hover .section-logo {
            opacity: 0.9;
            transform: scale(1.3) rotate(15deg);
            filter: drop-shadow(0 0 20px var(--accent-color));
            animation: pulse-logo 1.5s ease-in-out infinite;
        }
        .day-plan {
            margin-bottom: 30px;
            border-left: 3px solid var(--accent-color);
            padding-left: 20px;
            opacity: 1; /* Changed from 0 to 1 to ensure visibility */
            transform: translateX(0); /* Changed from -20px to 0 */
            transition: opacity 0.5s ease, transform 0.5s ease;
        }
        .day-plan.visible {
            opacity: 1;
            transform: translateX(0);
        }
        .day-plan h3 {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .day-plan h3 i {
            color: var(--accent-color);
        }
        .workout-item {
            display: flex;
            align-items: center;
            gap: 20px;
            background-color: var(--bg-dark);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            opacity: 1; /* Changed from 0 to 1 to ensure visibility */
            transform: translateY(0); /* Changed from 20px to 0 */
            position: relative;
            transform: perspective(500px) rotateX(0);
            transform-style: preserve-3d;
        }
        .workout-item.visible {
            opacity: 1;
            transform: translateY(0);
            transition: opacity 0.5s ease, transform 0.5s ease;
        }
        .workout-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        .workout-item:hover::before {
            left: 100%;
        }
        .workout-item:hover {
            transform: translateX(10px) perspective(500px) rotateX(5deg);
            box-shadow: 0 5px 15px rgba(0, 255, 255, 0.3);
            border-left: 3px solid var(--accent-color);
        }
        .workout-icon {
            font-size: 2.5rem;
            color: var(--accent-color);
            opacity: 0.7;
            transition: all 0.3s ease;
        }
        .workout-item:hover .workout-icon {
            opacity: 1;
            transform: scale(1.1);
            filter: drop-shadow(0 0 10px var(--accent-color));
        }
        .workout-details {
            flex-grow: 1;
        }
        .workout-details h4 {
            font-size: 1.25rem;
            margin-bottom: 5px;
            color: var(--text-primary);
        }
        .workout-details p {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 0;
        }
        .diet-item {
            background-color: var(--bg-dark);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            opacity: 1; /* Changed from 0 to 1 to ensure visibility */
            transform: translateY(0); /* Changed from 20px to 0 */
            position: relative;
            transform: perspective(500px) rotateX(0);
            transform-style: preserve-3d;
        }
        .diet-item.visible {
            opacity: 1;
            transform: translateY(0);
            transition: opacity 0.5s ease, transform 0.5s ease;
        }
        .diet-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        .diet-item:hover::before {
            left: 100%;
        }
        .diet-item:hover {
            transform: translateY(-5px) perspective(500px) rotateX(5deg);
            box-shadow: 0 10px 20px rgba(0, 255, 255, 0.3);
            border-left: 3px solid var(--accent-color);
        }
        .diet-item h3 {
            font-size: 1.25rem;
            margin-bottom: 5px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .diet-item h3 i {
            color: var(--accent-color);
            animation: icon-float 3s ease-in-out infinite;
        }
        
        /* Floating Elements */
        .floating-element {
            position: absolute;
            opacity: 0.1;
            z-index: -1;
            animation: float-random 15s infinite ease-in-out;
        }
        .floating-element.dumbbell { font-size: 3rem; color: var(--accent-color); top: 20%; left: 10%; animation-delay: 0s; }
        .floating-element.running { font-size: 2.5rem; color: var(--accent-color); top: 60%; right: 15%; animation-delay: 2s; }
        .floating-element.cycling { font-size: 2.8rem; color: var(--accent-color); bottom: 30%; left: 20%; animation-delay: 4s; }
        .floating-element.swimming { font-size: 2.2rem; color: var(--accent-color); top: 30%; right: 25%; animation-delay: 1s; }
        .floating-element.weightlifting { font-size: 2.6rem; color: var(--accent-color); bottom: 40%; right: 10%; animation-delay: 3s; }
        .floating-element.yoga { font-size: 2.4rem; color: var(--accent-color); top: 50%; left: 5%; animation-delay: 5s; }
        /* Footer */
        .footer {
            background: var(--bg-darker);
            border-top: 1px solid var(--border-subtle);
            padding: 4rem 0 2rem;
            text-align: center;
            margin-top: 4rem;
        }
        .footer p {
            font-size: 1.1rem;
            color: var(--text-secondary);
        }
        /* Loading Spinner */
        .loading-spinner {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100px;
            animation: fadeIn 0.5s ease forwards;
        }
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(0, 255, 255, 0.1);
            border-radius: 50%;
            border-top-color: var(--accent-color);
            animation: spin 1s ease-in-out infinite;
        }
        /* Animations */
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes gradient-shift { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes smash { 0% { transform: translate(0, 0) scale(1) rotate(0deg); opacity: 1; } 100% { transform: translate(var(--tx), var(--ty)) scale(0) rotate(720deg); opacity: 0; } }
        @keyframes glassBreak { 0% { transform: scale(0); opacity: 1; } 50% { transform: scale(1); opacity: 0.8; } 100% { transform: scale(1.2); opacity: 0; } }
        @keyframes shardFly { 0% { transform: translate(0, 0) rotate(0deg); opacity: 1; } 100% { transform: translate(var(--tx), var(--ty)) rotate(var(--rotation)); opacity: 0; } }
        @keyframes slideDown { from { transform: translateY(-100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes pulse { 0%, 100% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.2); opacity: 0.8; } }
        @keyframes pulse-logo { 0%, 100% { transform: scale(1.3) rotate(15deg); } 50% { transform: scale(1.4) rotate(20deg); } }
        @keyframes icon-float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-10px); } }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-15px); } }
        @keyframes float-random { 0%, 100% { transform: translate(0, 0) rotate(0deg); } 25% { transform: translate(20px, -30px) rotate(5deg); } 50% { transform: translate(-10px, -50px) rotate(-5deg); } 75% { transform: translate(15px, -20px) rotate(3deg); } }
        @keyframes pulse-grow { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        @keyframes loadingPulse { 0%, 100% { transform: scaleY(0.5); } 50% { transform: scaleY(1); } }
        @keyframes spin-reverse { from { transform: rotate(0deg) scale(0.8); } to { transform: rotate(-360deg) scale(0.8); } }
        @keyframes error-glow { 0% { box-shadow: 0 0 5px rgba(255, 77, 77, 0.5); } 50% { box-shadow: 0 0 20px rgba(255, 77, 77, 0.8); } 100% { box-shadow: 0 0 5px rgba(255, 77, 77, 0.5); } }
        @keyframes log-success { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        @keyframes pulse-glow {
            0% { box-shadow: 0 0 5px var(--accent-color); }
            50% { box-shadow: 0 0 20px var(--accent-color), 0 0 30px var(--accent-color); }
            100% { box-shadow: 0 0 5px var(--accent-color); }
        }
        @keyframes pulse-glow-sub {
            0% { box-shadow: 0 0 5px var(--accent-orange); }
            50% { box-shadow: 0 0 20px var(--accent-orange), 0 0 30px var(--accent-orange); }
            100% { box-shadow: 0 0 5px var(--accent-orange); }
        }
        @keyframes health-restriction-pulse {
            0% { 
                box-shadow: 0 0 15px var(--health-restriction-color), 
                           0 0 30px var(--health-restriction-color),
                           inset 0 0 15px rgba(255, 0, 0, 0.3);
                transform: scale(1.02);
            }
            50% { 
                box-shadow: 0 0 30px var(--health-restriction-color), 
                           0 0 50px var(--health-restriction-color),
                           inset 0 0 25px rgba(255, 0, 0, 0.5);
                transform: scale(1.05);
            }
            100% { 
                box-shadow: 0 0 15px var(--health-restriction-color), 
                           0 0 30px var(--health-restriction-color),
                           inset 0 0 15px rgba(255, 0, 0, 0.3);
                transform: scale(1.02);
            }
        }
        @keyframes health-restriction-bg-pulse {
            0% { opacity: 0.2; }
            50% { opacity: 0.4; }
            100% { opacity: 0.2; }
        }
        @keyframes warning-icon-pulse {
            0% { 
                transform: scale(1); 
                box-shadow: 0 0 20px rgba(255, 0, 0, 0.9);
            }
            50% { 
                transform: scale(1.3); 
                box-shadow: 0 0 30px rgba(255, 0, 0, 1);
            }
            100% { 
                transform: scale(1); 
                box-shadow: 0 0 20px rgba(255, 0, 0, 0.9);
            }
        }
        @keyframes warning-message-appear {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
            100% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }
        /* Responsive */
        @media (max-width: 768px) {
             .header-content { justify-content: space-between; padding: 0 1rem;}
             .wizard-header h1 { font-size: 2.2rem; }
             .wizard-header p { font-size: 1rem; }
             .workout-item { flex-direction: column; text-align: center; }
             .wizard-container { padding: 20px; }
             .biometrics-grid { grid-template-columns: 1fr; }
             .history-modal { flex-direction: column; height: 90vh; }
             .history-list { width: 100%; height: 40%; border-right: none; border-bottom: 1px solid var(--border-subtle); }
             .history-details { width: 100%; height: 60%; }
             .body-type-options { grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); }
             .dietary-options { grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); }
             .dietary-sub-options { 
                 max-height: 250px;
                 grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
             }
             .dietary-sub-option.health-restriction { 
                 min-height: 320px; 
                 padding: 15px;
             }
             .health-issues-options { grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); }
             .health-warning-message { max-width: 90%; padding: 20px; }
             .health-warning-message h3 { font-size: 1.3rem; }
             .health-warning-message p { font-size: 0.9rem; }
             .equipment-options { grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); }
             .workout-mode-options { flex-direction: column; gap: 15px; }
             .dietary-option { padding-right: 50px; } /* Adjust for mobile */
             .dietary-toggle-block { width: 35px; height: 35px; } /* Adjust for mobile */
        }
    </style>
</head>
<body>
    <canvas id="particle-background"></canvas>
    <div id="root"></div>
    <div id="ambient-glow"></div>
    
    <div className="floating-element dumbbell"><i className="fas fa-dumbbell"></i></div>
    <div className="floating-element running"><i className="fas fa-running"></i></div>
    <div className="floating-element cycling"><i className="fas fa-bicycle"></i></div>
    <div className="floating-element swimming"><i className="fas fa-swimmer"></i></div>
    <div className="floating-element weightlifting"><i className="fas fa-dumbbell"></i></div>
    <div className="floating-element yoga"><i className="fas fa-spa"></i></div>
    
    <audio id="smash-sound" src="https://assets.codepen.io/605876/click.mp3" preload="auto"></audio>
    <audio id="log-success-sound" src="https://assets.codepen.io/605876/success-generic.mp3" preload="auto"></audio>
    
    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;
        
        // Unchanged Components from Original Code
        const LoadingScreen = () => {
            const [isLoading, setIsLoading] = useState(true);
            useEffect(() => {
                const timer = setTimeout(() => setIsLoading(false), 3500);
                return () => clearTimeout(timer);
            }, []);
            if (!isLoading) return null;
            return (
                <div className="loading-screen">
                    <div className="loading-container">
                        <div className="loading-animation">
                            <div className="loading-circle"></div>
                            <div className="loading-circle-alt"></div>
                            <i className="fas fa-dumbbell loading-icon"></i>
                        </div>
                        <div className="loading-text">
                            <h2>ELITE PERFORMANCE</h2>
                            <p>"Champions are made when nobody's watching"</p>
                        </div>
                        <div className="loading-progress">
                            {[...Array(5)].map((_, i) => <div className="loading-bar" key={i}></div>)}
                        </div>
                    </div>
                </div>
            );
        };
        const CustomCursor = () => {
            const [position, setPosition] = useState({ x: -100, y: -100 });
            useEffect(() => {
                const handleMouseMove = (e) => setPosition({ x: e.clientX, y: e.clientY });
                window.addEventListener('mousemove', handleMouseMove);
                return () => window.removeEventListener('mousemove', handleMouseMove);
            }, []);
            return (
                <div className="custom-cursor" style={{ left: `${position.x}px`, top: `${position.y}px` }}>
                    <i className="fas fa-dumbbell dumbbell-cursor"></i>
                </div>
            );
        };
        const AmbientGlow = () => {
            useEffect(() => {
                const glowElement = document.getElementById('ambient-glow');
                const handleMouseMove = (e) => {
                    glowElement.style.setProperty('--x', `${e.clientX}px`);
                    glowElement.style.setProperty('--y', `${e.clientY}px`);
                };
                window.addEventListener('mousemove', handleMouseMove);
                return () => window.removeEventListener('mousemove', handleMouseMove);
            }, []);
            return null;
        };
        const SmashEffectContainer = ({ smashEvents }) => {
            const [particles, setParticles] = useState([]);
            const [glassBreaks, setGlassBreaks] = useState([]);
            const [glassShards, setGlassShards] = useState([]);
            const breakSound = useRef(null);
            useEffect(() => {
                breakSound.current = document.getElementById('smash-sound');
            }, []);
            const sportIcons = ['fas fa-dumbbell', 'fas fa-running', 'fas fa-bicycle', 'fas fa-swimmer', 'fas fa-fist-raised', 'fas fa-basketball-ball', 'fas fa-football-ball', 'fas fa-table-tennis', 'fas fa-volleyball-ball', 'fas fa-baseball-ball'];
            useEffect(() => {
                if (smashEvents.length === 0) return;
                const { x, y } = smashEvents[smashEvents.length - 1];
                if (breakSound.current) {
                    breakSound.current.volume = 0.5;
                    breakSound.current.currentTime = 0;
                    breakSound.current.play().catch(err => console.error("Audio play failed:", err));
                }
                
                // Create glass break effect
                const newGlassBreak = document.createElement('div');
                newGlassBreak.className = 'glass-break';
                newGlassBreak.style.left = `${x - 75}px`;
                newGlassBreak.style.top = `${y - 75}px`;
                newGlassBreak.style.width = '150px';
                newGlassBreak.style.height = '150px';
                newGlassBreak.style.borderRadius = '50%';
                newGlassBreak.style.background = `radial-gradient(circle, rgba(255,255,255,0.9) 0%, rgba(0, 255, 255, 0.88) 50%, transparent 70%)`;
                setGlassBreaks(prev => [...prev, newGlassBreak]);
                
                // Create glass shards
                const newShards = [];
                for (let i = 0; i < 25; i++) {
                    const shard = document.createElement('div');
                    shard.className = 'glass-shard';
                    shard.style.left = `${x}px`;
                    shard.style.top = `${y}px`;
                    shard.style.width = `${Math.random() * 15 + 5}px`;
                    shard.style.height = `${Math.random() * 20 + 8}px`;
                    shard.style.setProperty('--tx', `${(Math.random() - 0.5) * 150}px`);
                    shard.style.setProperty('--ty', `${(Math.random() - 0.5) * 150}px`);
                    shard.style.setProperty('--rotation', `${(Math.random() - 0.5) * 360}deg`);
                    shard.style.animationDuration = `${Math.random() * 0.8 + 0.8}s`;
                    shard.style.background = `linear-gradient(45deg, rgba(255, 255, 255, 0.8), rgba(0, 255, 255, 0.88))`;
                    newShards.push(shard);
                }
                setGlassShards(prev => [...prev, ...newShards]);
                
                // Create icon particles
                const newParticles = Array.from({ length: 25 }).map((_, i) => ({ 
                    id: `p-${Date.now()}-${i}`, 
                    x, 
                    y, 
                    icon: sportIcons[Math.floor(Math.random() * sportIcons.length)], 
                    tx: (Math.random() - 0.5) * 150, 
                    ty: (Math.random() - 0.5) * 150, 
                    duration: Math.random() * 0.8 + 0.8 
                }));
                setParticles(prev => [...prev, ...newParticles]);
                
                // Clean up effects after animations
                setTimeout(() => {
                    setGlassBreaks([]);
                    setGlassShards([]);
                    setParticles([]);
                }, 1500);
            }, [smashEvents]);
            
            return (
                <div className="smash-container">
                    {glassBreaks.map((breakEl, i) => (
                        <div key={i} className="glass-break" style={{
                            left: breakEl.style.left,
                            top: breakEl.style.top,
                            width: breakEl.style.width,
                            height: breakEl.style.height,
                            borderRadius: breakEl.style.borderRadius,
                            background: breakEl.style.background
                        }}></div>
                    ))}
                    {glassShards.map((shard, i) => (
                        <div key={i} className="glass-shard" style={{
                            left: shard.style.left,
                            top: shard.style.top,
                            width: shard.style.width,
                            height: shard.style.height,
                            '--tx': shard.style.getPropertyValue('--tx'),
                            '--ty': shard.style.getPropertyValue('--ty'),
                            '--rotation': shard.style.getPropertyValue('--rotation'),
                            animationDuration: shard.style.animationDuration,
                            background: shard.style.background
                        }}></div>
                    ))}
                    {particles.map(p => (
                        <div key={p.id} className="smash-particle" style={{ 
                            left: p.x, 
                            top: p.y, 
                            '--tx': `${p.tx}px`, 
                            '--ty': `${p.ty}px`, 
                            animationDuration: `${p.duration}s` 
                        }}>
                            <i className={p.icon}></i>
                        </div>
                    ))}
                </div>
            );
        };
        
        // RENDER GENERATED PLAN COMPONENT
        const GeneratedPlan = ({ plan, planRef }) => {
            useScrollAnimation();
            
            // Add debugging
            console.log("GeneratedPlan component received plan:", plan);
            
            // Calculate water intake based on weight
            const weight = parseFloat(plan.weight) || 70; // Default to 70kg if weight is not available
            const waterIntake = Math.round(weight * 0.033 * 1000); // ml per day
            
            // Days of the week
            const daysOfWeek = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
            
            // Ensure workout_plan and diet_plan are arrays
            const workoutPlan = Array.isArray(plan.workout_plan) ? plan.workout_plan : [];
            const dietPlan = Array.isArray(plan.diet_plan) ? plan.diet_plan : [];
            const sleepSchedule = plan.sleep_schedule || {};
            
            // Add debugging
            console.log("workoutPlan:", workoutPlan);
            console.log("dietPlan:", dietPlan);
            console.log("sleepSchedule:", sleepSchedule);
            
            return (
                 <div id="generated-plan" ref={planRef}>
                    {/* Debug: Show if plans are empty */}
                    {workoutPlan.length === 0 && dietPlan.length === 0 && (
                        <div style={{padding: '20px', backgroundColor: 'rgba(255,0,0,0.1)', borderRadius: '10px', marginBottom: '20px'}}>
                            <h3 style={{color: 'var(--error-color)'}}>Debug: No workout or diet plan found</h3>
                            <p>The plan data might be missing or corrupted. Check the debug information above.</p>
                        </div>
                    )}
                    
                    <div className="plan-section">
                        <h2><i className="fas fa-calendar-week"></i> Weekly Plan</h2>
                        <div className="section-logo"><i className="fas fa-calendar-week"></i></div>
                        
                        {daysOfWeek.map(day => {
                            // Get workout for this day
                            const dayWorkout = workoutPlan.find(w => w.d && w.d.toLowerCase().includes(day.toLowerCase()));
                            
                            // Get meals for this day
                            const dayMeals = dietPlan.filter(m => m.d && m.d.toLowerCase().includes(day.toLowerCase()));
                            
                            return (
                                <div key={day} className="day-plan">
                                    <h3><i className="fas fa-calendar-day"></i> {day}</h3>
                                    
                                    {/* Workout Section */}
                                    {dayWorkout && (
                                        <div style={{marginBottom: '20px'}}>
                                            <h4 style={{color: 'var(--accent-color)', marginBottom: '10px'}}>
                                                <i className="fas fa-dumbbell"></i> Workout: {dayWorkout.t || 'Unknown'} ({dayWorkout.dur || 'N/A'})
                                            </h4>
                                            {Array.isArray(dayWorkout.ex) && dayWorkout.ex.map((exercise, exerciseIndex) => (
                                                <div key={exerciseIndex} className="workout-item">
                                                    <i className={`${exercise.icon || 'fas fa-dumbbell'} workout-icon`}></i>
                                                    <div className="workout-details">
                                                        <h4>{exercise.n || 'Unknown Exercise'}</h4>
                                                        <p>{exercise.s || 0} sets of {exercise.r || 0} reps</p>
                                                        <p>{exercise.desc || 'No description available'}</p>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                    
                                    {/* Diet Section */}
                                    {dayMeals.length > 0 && (
                                        <div>
                                            <h4 style={{color: 'var(--accent-color)', marginBottom: '10px'}}>
                                                <i className="fas fa-utensils"></i> Diet Plan
                                            </h4>
                                            {dayMeals.map((meal, mealIndex) => (
                                                <div key={mealIndex} className="diet-item">
                                                    <h3><i className="fas fa-utensils"></i> {meal.mt || 'Meal'}</h3>
                                                    <p><strong>{meal.t || 'Unknown'}</strong><br/>{meal.det || 'No details available'}</p>
                                                </div>
                                            ))}
                                            
                                            {/* Water Intake */}
                                            <div className="diet-item">
                                                <h3><i className="fas fa-tint"></i> Water Intake</h3>
                                                <p>Aim for at least {waterIntake}ml (approximately {Math.round(waterIntake/250)} glasses) of water throughout the day.</p>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            );
                        })}
                    </div>
                    
                    {/* Sleep Schedule Section */}
                    {sleepSchedule && (
                         <div className="plan-section">
                            <h2><i className="fas fa-bed"></i> Sleep Schedule</h2>
                             <div className="section-logo"><i className="fas fa-bed"></i></div>
                             <div className="diet-item">
                                 <h3><i className="fas fa-clock"></i> Recommended Sleep</h3>
                                 <p>{sleepSchedule.hrs || 'N/A'} hours</p>
                             </div>
                             <div className="diet-item">
                                 <h3><i className="fas fa-moon"></i> Routine</h3>
                                 <p>{sleepSchedule.rt || 'No specific routine provided'}</p>
                             </div>
                        </div>
                    )}
                </div>
            )
        }
        
        // UPDATED Header Component
        const Header = ({ onHistoryClick }) => {
            const [scrolled, setScrolled] = useState(false);
            const [isProfileDropdownOpen, setIsProfileDropdownOpen] = useState(false);
            const [userName, setUserName] = useState("Athlete");
            useEffect(() => {
                const storedName = localStorage.getItem('userName');
                if (storedName) {
                    setUserName(storedName);
                }
                const handleScroll = () => setScrolled(window.scrollY > 10);
                window.addEventListener('scroll', handleScroll);
                return () => window.removeEventListener('scroll', handleScroll);
            }, []);
            
            const handleLogout = (e) => {
                e.preventDefault();
                setIsProfileDropdownOpen(false);
                console.log("User logged out.");
                localStorage.removeItem('userName');
                window.location.href = 'index.html';
            };
            
            const testMongo = async () => {
                try {
                    const response = await fetch('http://127.0.0.1:5000/api/test-mongo', {
                        method: 'GET',
                        credentials: 'include'
                    });
                    const data = await response.json();
                    if (data.success) {
                        alert(`MongoDB test successful! Inserted ID: ${data.inserted_id}`);
                    } else {
                        alert(`MongoDB test failed: ${data.message}`);
                    }
                } catch (error) {
                    alert(`Error testing MongoDB: ${error.message}`);
                }
            };
            
            const checkAuth = async () => {
                try {
                    const response = await fetch('http://127.0.0.1:5000/api/check-auth', {
                        method: 'GET',
                        credentials: 'include'
                    });
                    const data = await response.json();
                    alert(`Logged in: ${data.logged_in}, Email: ${data.user_email || 'None'}`);
                } catch (error) {
                    alert(`Error checking auth: ${error.message}`);
                }
            };
            
            return (
                <header className={scrolled ? 'scrolled' : ''}>
                    <div className="header-content">
                        <a href="plan.html" className="logo">
                            <i className="fas fa-dumbbell logo-icon"></i>
                            <span>ELITE</span>
                        </a>
                        <div className="header-nav">
                            <button className="btn-secondary" onClick={testMongo} style={{marginRight: '10px'}}>
                                <i className="fas fa-database"></i> Test MongoDB
                            </button>
                            <button className="btn-secondary" onClick={checkAuth} style={{marginRight: '10px'}}>
                                <i className="fas fa-user-check"></i> Check Auth
                            </button>
                             <button className="btn-secondary" onClick={onHistoryClick}>
                                <i className="fas fa-history" style={{marginRight: '8px'}}></i> History
                             </button>
                            <div className="profile-dropdown">
                                <button className="profile-btn" onClick={() => setIsProfileDropdownOpen(!isProfileDropdownOpen)}>
                                    <div className="profile-avatar"><i className="fas fa-user"></i></div>
                                    <span>{userName}</span>
                                    <i className="fas fa-chevron-down"></i>
                                </button>
                                <div className={`dropdown-menu ${isProfileDropdownOpen ? 'active' : ''}`}>
                                    <a href="#" className="dropdown-item" onClick={handleLogout}><i className="fas fa-sign-out-alt"></i> Logout</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </header>
            );
        };
        
        // History Modal Component (using MongoDB)
        const HistoryModal = ({ isVisible, onClose }) => {
            const [history, setHistory] = useState([]);
            const [selectedPlan, setSelectedPlan] = useState(null);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);
            useEffect(() => {
                if (isVisible) {
                    setLoading(true);
                    setError(null);
                    
                    console.log("Fetching workout history..."); // Debug log
                    
                    fetch('http://127.0.0.1:5000/api/get-workout-history', {
                        method: 'GET',
                        credentials: 'include' // Include session cookies
                    })
                    .then(response => {
                        console.log("History response status:", response.status); // Debug log
                        
                        if (!response.ok) {
                            throw new Error(`Failed to fetch history: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        console.log("History data:", data); // Debug log
                        
                        // Check if the response is an error
                        if (data.success === false) {
                            throw new Error(data.message || "Failed to fetch history");
                        }
                        
                        // Process the history data from MongoDB
                        const processedHistory = data.map(item => {
                            console.log("Processing history item:", item); // Debug log
                            
                            // Ensure planData is properly formatted
                            let planData = item.plan || {};
                            
                            // If plan is stored as a string (which can happen with some MongoDB configurations)
                            if (typeof planData === 'string') {
                                try {
                                    planData = JSON.parse(planData);
                                } catch (e) {
                                    console.error("Error parsing planData:", e);
                                    planData = {
                                        workout_plan: [],
                                        diet_plan: [],
                                        sleep_schedule: {}
                                    };
                                }
                            }
                            
                            // Ensure plan has required fields
                            if (!Array.isArray(planData.workout_plan)) {
                                planData.workout_plan = [];
                            }
                            if (!Array.isArray(planData.diet_plan)) {
                                planData.diet_plan = [];
                            }
                            if (!planData.sleep_schedule || typeof planData.sleep_schedule !== 'object') {
                                planData.sleep_schedule = {};
                            }
                            
                            // Ensure weight is included
                            if (!planData.weight) {
                                planData.weight = item.weight || 70;
                            }
                            
                            return {
                                id: item._id,
                                goal: item.goal || 'Unknown Goal',
                                createdAt: item.date,
                                planData: planData
                            };
                        });
                        
                        console.log("Processed history:", processedHistory); // Debug log
                        
                        setHistory(processedHistory);
                        if (processedHistory.length > 0 && !selectedPlan) {
                            setSelectedPlan(processedHistory[0]);
                        }
                    })
                    .catch(error => {
                        console.error("Error fetching history:", error);
                        setError(error.message);
                    })
                    .finally(() => {
                        setLoading(false);
                    });
                }
            }, [isVisible]);
            if (!isVisible) return null;
            
            return (
                <div className={`history-modal-overlay ${isVisible ? 'visible' : ''}`} onClick={onClose}>
                    <div className="history-modal" onClick={(e) => e.stopPropagation()}>
                        <button onClick={onClose} className="history-close-btn"><i className="fas fa-times"></i></button>
                        <div className="history-list">
                            {loading ? (
                                <p style={{padding: '1.5rem'}}>Loading history...</p>
                            ) : error ? (
                                <p style={{padding: '1.5rem', color: 'var(--error-color)'}}>Error: {error}</p>
                            ) : history.length === 0 ? (
                                <p style={{padding: '1.5rem'}}>No history yet. Generate and log a plan!</p>
                            ) : (
                                history.map(plan => (
                                    <div 
                                        key={plan.id} 
                                        className={`history-list-item ${selectedPlan?.id === plan.id ? 'selected' : ''}`}
                                        onClick={() => setSelectedPlan(plan)}
                                    >
                                        <h4>{plan.goal.replace(/-/g, ' ')}</h4>
                                        <p>{new Date(plan.createdAt).toLocaleString()}</p>
                                    </div>
                                ))
                            )}
                        </div>
                        <div className="history-details">
                            {selectedPlan ? (
                                <div className="history-details-content">
                                    <h2>Plan from {new Date(selectedPlan.createdAt).toLocaleDateString()}</h2>
                                    {/* Debug: Show the plan data structure */}
                                    <details style={{marginBottom: '20px', cursor: 'pointer'}}>
                                        <summary style={{color: 'var(--accent-color)'}}>Debug: Plan Data Structure</summary>
                                        <pre style={{background: 'rgba(0,0,0,0.3)', padding: '10px', borderRadius: '5px', overflow: 'auto', maxHeight: '200px'}}>
                                            {JSON.stringify(selectedPlan.planData, null, 2)}
                                        </pre>
                                    </details>
                                    <GeneratedPlan plan={selectedPlan.planData} />
                                </div>
                            ) : (
                                <p>Select a plan to view details.</p>
                            )}
                        </div>
                    </div>
                </div>
            );
        }
        
        // Scroll Animation Hook
        const useScrollAnimation = () => {
            useEffect(() => {
                const elements = document.querySelectorAll('.plan-section, .day-plan, .workout-item, .diet-item');
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            entry.target.classList.add('visible');
                        }
                    });
                }, { threshold: 0.1 });
                elements.forEach(el => observer.observe(el));
                return () => elements.forEach(el => observer.unobserve(el));
            }, []);
        };
        
        // REVAMPED Plan Selector Component
        const PlanSelector = () => {
            const [step, setStep] = useState(1);
            const [formData, setFormData] = useState({
                goal: 'build-muscle', 
                age: '', 
                weight: '', 
                heightFt: '', 
                heightIn: '', 
                fitnessLevel: 'beginner', 
                dietaryPreferences: [],
                avoidFoods: [],
                bodyType: '',
                hasHealthIssues: 'no',
                healthConditions: [],
                equipment: [],
                workoutMode: 'Home'
            });
            const [expandedDietaryOptions, setExpandedDietaryOptions] = useState([]);
            const [generatedPlan, setGeneratedPlan] = useState(null);
            const [isLoading, setIsLoading] = useState(false);
            const [isLogging, setIsLogging] = useState(false);
            const [isPlanLogged, setIsPlanLogged] = useState(false);
            const [errors, setErrors] = useState({});
            const [showHealthWarning, setShowHealthWarning] = useState(false);
            const planRef = useRef(null);
            const totalSteps = 6;
            const progress = ((step - 1) / (totalSteps -1)) * 100;
            
            // Expanded goal options (6 goals related to weight and fitness)
            const goalOptions = [
                { value: 'build-muscle', label: 'Build Muscle', icon: 'fa-dumbbell' },
                { value: 'lose-weight', label: 'Lose Weight', icon: 'fa-weight' },
                { value: 'improve-endurance', label: 'Improve Endurance', icon: 'fa-running' },
                { value: 'increase-flexibility', label: 'Increase Flexibility', icon: 'fa-spa' },
                { value: 'gain-weight', label: 'Gain Weight', icon: 'fa-weight-hanging' },
                { value: 'maintain-weight', label: 'Maintain Weight', icon: 'fa-balance-scale' }
            ];
            
            // Body type options
            const bodyTypeOptions = [
                { value: 'ectomorph', label: 'Lean', image: 'lean.jpg.png' },
                { value: 'mesomorph', label: 'Muscular', image: 'muscular.jpg.png' },
                { value: 'endomorph', label: 'Stocky', image: 'stocky.jpg.png' },
                { value: 'athletic', label: 'Athletic', image: 'athletic.jpg.png' },
                { value: 'overweight', label: 'Overweight', image: 'overweight.jpg.png' },
                { value: 'obese', label: 'Obese', image: 'obese.jpg.png' }
            ];
            
             const fitnessLevelOptions = [
                { value: 'beginner', label: 'Beginner', icon: 'fa-seedling' },
                { value: 'intermediate', label: 'Intermediate', icon: 'fa-chart-line' },
                { value: 'advanced', label: 'Advanced', icon: 'fa-trophy' }
            ];
            
            // Equipment options - From First Code
            const equipmentOptions = [
                { value: 'Dumbbells', label: 'Dumbbells' },
                { value: 'Barbell', label: 'Barbell' },
                { value: 'Resistance Bands', label: 'Resistance Bands' },
                { value: 'Kettlebell', label: 'Kettlebell' },
                { value: 'Pull-up Bar', label: 'Pull-up Bar' },
                { value: 'Bench', label: 'Bench' },
                { value: 'Treadmill', label: 'Treadmill' },
                { value: 'Stationary Bike', label: 'Stationary Bike' },
                { value: 'Elliptical', label: 'Elliptical' },
                { value: 'Rowing Machine', label: 'Rowing Machine' },
                { value: 'None', label: 'None' }
            ];
            
            // Dietary preference options - From First Code
            const dietaryOptions = [
                { value: 'Vegetarian', label: 'Vegetarian', subOptions: ['Lacto-vegetarian', 'Ovo-vegetarian', 'Lacto-ovo vegetarian', 'Vegan'] },
                { value: 'Keto', label: 'Ketogenic', subOptions: ['Standard Keto', 'Cyclical Keto', 'Targeted Keto', 'High-protein Keto'] },
                { value: 'Paleo', label: 'Paleo', subOptions: ['Standard Paleo', 'Autoimmune Protocol', 'Low-FODMAP Paleo'] },
                { value: 'Mediterranean', label: 'Mediterranean', subOptions: ['Traditional Mediterranean', 'Greek Mediterranean', 'Spanish Mediterranean'] },
                { value: 'Low-carb', label: 'Low Carb', subOptions: ['Standard Low-carb', 'Moderate Low-carb', 'Very Low-carb'] },
                { value: 'Dairy-free', label: 'Dairy Free', subOptions: ['Lactose-free', 'Casein-free', 'Whey-free'] },
                { value: 'Gluten-free', label: 'Gluten Free', subOptions: ['Wheat-free', 'Barley-free', 'Rye-free'] },
                { value: 'Sugar-free', label: 'Sugar Free', subOptions: ['Refined Sugar-free', 'Natural Sugar-free', 'Artificial Sweeteners'] },
                { value: 'Low-sodium', label: 'Low Sodium', subOptions: ['No Added Salt', 'Very Low Sodium', 'Reduced Sodium'] },
                { value: 'High-protein', label: 'High Protein', subOptions: ['Animal-based', 'Plant-based', 'Mixed Sources'] },
                { value: 'Intermittent Fasting', label: 'Intermittent Fasting', subOptions: ['16:8 Method', '5:2 Diet', 'Eat-Stop-Eat', 'Alternate Day'] },
                { value: 'Health Restrictions', label: 'Health Restrictions', subOptions: ['Diabetes', 'Heart Disease', 'High Blood Pressure', 'Food Allergies', 'Celiac Disease', 'Kidney Disease', 'Digestive Issues'] }
            ];
            
            // Workout mode options - From First Code
            const workoutModeOptions = [
                { value: 'Home', label: 'Home Workouts' },
                { value: 'Gym', label: 'Gym Workouts' },
                { value: 'Outdoor', label: 'Outdoor Activities' },
                { value: 'Hybrid', label: 'Hybrid (Home + Gym)' }
            ];
            
            // Health issues options - From First Code
            const healthIssuesOptions = [
                { value: 'Diabetes', label: 'Diabetes' },
                { value: 'Heart Disease', label: 'Heart Disease' },
                { value: 'High Blood Pressure', label: 'High Blood Pressure' },
                { value: 'Asthma', label: 'Asthma' },
                { value: 'Arthritis', label: 'Arthritis' },
                { value: 'Back Pain', label: 'Back Pain' },
                { value: 'Knee Pain', label: 'Knee Pain' },
                { value: 'Shoulder Injury', label: 'Shoulder Injury' },
                { value: 'Food Allergies', label: 'Food Allergies' },
                { value: 'Celiac Disease', label: 'Celiac Disease' },
                { value: 'Kidney Disease', label: 'Kidney Disease' },
                { value: 'Digestive Issues', label: 'Digestive Issues' }
            ];
            
            const [smashEvents, setSmashEvents] = useState([]);
            const [showHistoryModal, setShowHistoryModal] = useState(false);
            
            const handleSmash = (e) => {
                const rect = e.currentTarget.getBoundingClientRect();
                const x = rect.left + rect.width / 2;
                const y = rect.top + rect.height / 2;
                setSmashEvents(prev => [...prev, { x, y }]);
            };
            
            const handleInputChange = (e) => {
                const { name, value } = e.target;
                setFormData(prev => ({ ...prev, [name]: value }));
                
                // Clear error when user starts typing
                if (errors[name]) {
                    setErrors(prev => {
                        const newErrors = { ...prev };
                        delete newErrors[name];
                        return newErrors;
                    });
                }
            };
            
            const handleSelection = (field, value) => {
                setFormData(prev => ({ ...prev, [field]: value }));
                
                // Clear error when user makes a selection
                if (errors[field]) {
                    setErrors(prev => {
                        const newErrors = { ...prev };
                        delete newErrors[field];
                        return newErrors;
                    });
                }
            };
            
            const handleEquipmentChange = (equipment) => {
                setFormData(prev => {
                    const equipmentList = [...prev.equipment];
                    if (equipmentList.includes(equipment)) {
                        return { ...prev, equipment: equipmentList.filter(item => item !== equipment) };
                    } else {
                        return { ...prev, equipment: [...equipmentList, equipment] };
                    }
                });
            };
            
            const handleDietaryPreferenceChange = (preference) => {
                setFormData(prev => {
                    const preferences = [...prev.dietaryPreferences];
                    if (preferences.includes(preference)) {
                        return { ...prev, dietaryPreferences: preferences.filter(item => item !== preference) };
                    } else {
                        return { ...prev, dietaryPreferences: [...preferences, preference] };
                    }
                });
            };
            
            const handleAvoidFoodChange = (food) => {
                setFormData(prev => {
                    const avoidFoods = [...prev.avoidFoods];
                    if (avoidFoods.includes(food)) {
                        return { ...prev, avoidFoods: avoidFoods.filter(item => item !== food) };
                    } else {
                        return { ...prev, avoidFoods: [...avoidFoods, food] };
                    }
                });
            };
            
            const handleHealthConditionChange = (condition) => {
                setFormData(prev => {
                    const conditions = [...prev.healthConditions];
                    if (conditions.includes(condition)) {
                        return { ...prev, healthConditions: conditions.filter(item => item !== condition) };
                    } else {
                        return { ...prev, healthConditions: [...conditions, condition] };
                    }
                });
            };
            
            const toggleDietarySubOptions = (option) => {
                if (expandedDietaryOptions.includes(option)) {
                    setExpandedDietaryOptions(prev => prev.filter(item => item !== option));
                } else {
                    setExpandedDietaryOptions(prev => [...prev, option]);
                }
            };
            
            const validateStep = () => {
                const newErrors = {};
                
                if (step === 1) {
                    if (!formData.goal) newErrors.goal = 'Please select a fitness goal';
                } else if (step === 2) {
                    if (!formData.age) newErrors.age = 'Please enter your age';
                    if (!formData.weight) newErrors.weight = 'Please enter your weight';
                    if (!formData.heightFt) newErrors.heightFt = 'Please enter your height';
                    if (!formData.bodyType) newErrors.bodyType = 'Please select your body type';
                } else if (step === 3) {
                    if (!formData.fitnessLevel) newErrors.fitnessLevel = 'Please select your fitness level';
                } else if (step === 4) {
                    if (formData.equipment.length === 0) newErrors.equipment = 'Please select at least one equipment option';
                    if (!formData.workoutMode) newErrors.workoutMode = 'Please select a workout mode';
                } else if (step === 5) {
                    if (formData.dietaryPreferences.length === 0) newErrors.dietaryPreferences = 'Please select at least one dietary preference';
                    if (formData.hasHealthIssues === 'yes' && formData.healthConditions.length === 0) {
                        newErrors.healthConditions = 'Please select at least one health condition';
                    }
                }
                
                setErrors(newErrors);
                return Object.keys(newErrors).length === 0;
            };
            
            const handleNext = () => {
                if (validateStep()) {
                    if (step < totalSteps) {
                        setStep(prev => prev + 1);
                    } else {
                        handleGeneratePlan();
                    }
                }
            };
            
            const handlePrev = () => {
                if (step > 1) {
                    setStep(prev => prev - 1);
                }
            };
            
            const handleGeneratePlan = async () => {
                // Validate all steps before generating
                if (!validateStep()) return;
                
                setIsLoading(true);
                try {
                    const response = await fetch('http://127.0.0.1:5000/api/generate-plan', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(formData),
                        credentials: 'include'
                    });
                    const data = await response.json();
                    if (!response.ok) throw new Error(data.message || 'Failed to generate plan');
                    setGeneratedPlan(data);
                    setIsLoading(false);
                } catch (error) {
                    console.error('Error generating plan:', error);
                    setErrors({ general: error.message });
                    setIsLoading(false);
                }
            };
            
            const handleLogPlan = async () => {
                setIsLogging(true);
                try {
                    const response = await fetch('http://127.0.0.1:5000/api/log-workout', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ ...formData, plan: generatedPlan }),
                        credentials: 'include'
                    });
                    const data = await response.json();
                    if (!response.ok) throw new Error(data.message || 'Failed to log plan');
                    
                    // Play success sound
                    const successSound = document.getElementById('log-success-sound');
                    if (successSound) {
                        successSound.volume = 0.5;
                        successSound.currentTime = 0;
                        successSound.play().catch(err => console.error("Audio play failed:", err));
                    }
                    
                    setIsPlanLogged(true);
                    setIsLogging(false);
                    
                    // Reset the plan logged status after animation
                    setTimeout(() => {
                        setIsPlanLogged(false);
                    }, 3000);
                } catch (error) {
                    console.error('Error logging plan:', error);
                    setErrors({ general: error.message });
                    setIsLogging(false);
                }
            };
            
            const handleHistoryClick = () => {
                setShowHistoryModal(true);
            };
            
            const closeHistoryModal = () => {
                setShowHistoryModal(false);
            };
            
            // Render current step
            const renderStep = () => {
                switch (step) {
                    case 1:
                        return (
                            <div className="wizard-step">
                                <h2>What's Your Fitness Goal?</h2>
                                <div className="selection-grid">
                                    {goalOptions.map(goal => (
                                        <div 
                                            key={goal.value}
                                            className={`selection-card ${formData.goal === goal.value ? 'selected' : ''}`}
                                            onClick={() => handleSelection('goal', goal.value)}
                                        >
                                            <i className={`fas ${goal.icon}`}></i>
                                            <h3>{goal.label}</h3>
                                        </div>
                                    ))}
                                </div>
                                {errors.goal && <div className="error-message">{errors.goal}</div>}
                            </div>
                        );
                    case 2:
                        return (
                            <div className="wizard-step">
                                <h2>Tell Us About Yourself</h2>
                                <div className="biometrics-grid">
                                    <div className="input-group">
                                        <label>Age</label>
                                        <input 
                                            type="number" 
                                            name="age" 
                                            value={formData.age} 
                                            onChange={handleInputChange}
                                            min="16"
                                            max="100"
                                            className={errors.age ? 'error' : ''}
                                        />
                                        {errors.age && <div className="error-message">{errors.age}</div>}
                                    </div>
                                    <div className="input-group">
                                        <label>Weight (kg)</label>
                                        <input 
                                            type="number" 
                                            name="weight" 
                                            value={formData.weight} 
                                            onChange={handleInputChange}
                                            min="30"
                                            max="300"
                                            step="0.1"
                                            className={errors.weight ? 'error' : ''}
                                        />
                                        {errors.weight && <div className="error-message">{errors.weight}</div>}
                                    </div>
                                    <div className="input-group">
                                        <label>Height</label>
                                        <div className="height-inputs">
                                            <input 
                                                type="number" 
                                                name="heightFt" 
                                                value={formData.heightFt} 
                                                onChange={handleInputChange}
                                                placeholder="Feet"
                                                min="3"
                                                max="8"
                                                className={errors.heightFt ? 'error' : ''}
                                            />
                                            <input 
                                                type="number" 
                                                name="heightIn" 
                                                value={formData.heightIn} 
                                                onChange={handleInputChange}
                                                placeholder="Inches"
                                                min="0"
                                                max="11"
                                            />
                                        </div>
                                        {errors.heightFt && <div className="error-message">{errors.heightFt}</div>}
                                    </div>
                                    <div className="input-group">
                                        <label>Body Type</label>
                                        <div className="body-type-options">
                                            {bodyTypeOptions.map(type => (
                                                <div 
                                                    key={type.value}
                                                    className={`body-type-option ${formData.bodyType === type.value ? 'selected' : ''}`}
                                                    onClick={() => handleSelection('bodyType', type.value)}
                                                >
                                                    <img src={type.image} alt={type.label} className="body-model" />
                                                    <span>{type.label}</span>
                                                </div>
                                            ))}
                                        </div>
                                        {errors.bodyType && <div className="error-message">{errors.bodyType}</div>}
                                    </div>
                                </div>
                            </div>
                        );
                    case 3:
                        return (
                            <div className="wizard-step">
                                <h2>What's Your Fitness Level?</h2>
                                <div className="selection-grid">
                                    {fitnessLevelOptions.map(level => (
                                        <div 
                                            key={level.value}
                                            className={`selection-card ${formData.fitnessLevel === level.value ? 'selected' : ''}`}
                                            onClick={() => handleSelection('fitnessLevel', level.value)}
                                        >
                                            <i className={`fas ${level.icon}`}></i>
                                            <h3>{level.label}</h3>
                                        </div>
                                    ))}
                                </div>
                                {errors.fitnessLevel && <div className="error-message">{errors.fitnessLevel}</div>}
                                
                                <div className="fitness-description">
                                    <div className="fitness-level-item"><strong>Beginner:</strong> New to fitness or returning after a long break. Focus on building foundational strength and endurance.</div>
                                    <div className="fitness-level-item"><strong>Intermediate:</strong> Consistent exercise routine for 6+ months. Ready to increase intensity and try new exercises.</div>
                                    <div className="fitness-level-item"><strong>Advanced:</strong> Years of training experience. Comfortable with complex movements and high-intensity workouts.</div>
                                </div>
                            </div>
                        );
                    case 4:
                        return (
                            <div className="wizard-step">
                                <h2>Equipment & Workout Mode</h2>
                                <div className="input-group">
                                    <label>What equipment do you have access to?</label>
                                    <div className="equipment-options">
                                        {equipmentOptions.map(equipment => (
                                            <div 
                                                key={equipment.value}
                                                className={`equipment-option ${formData.equipment.includes(equipment.value) ? 'selected' : ''}`}
                                                onClick={() => handleEquipmentChange(equipment.value)}
                                            >
                                                <input 
                                                    type="checkbox" 
                                                    checked={formData.equipment.includes(equipment.value)}
                                                    onChange={() => {}}
                                                />
                                                <label>{equipment.label}</label>
                                            </div>
                                        ))}
                                    </div>
                                    {errors.equipment && <div className="error-message">{errors.equipment}</div>}
                                </div>
                                
                                <div className="input-group">
                                    <label>Where do you prefer to work out?</label>
                                    <div className="workout-mode-options">
                                        {workoutModeOptions.map(mode => (
                                            <div 
                                                key={mode.value}
                                                className={`workout-mode-option ${formData.workoutMode === mode.value ? 'selected' : ''}`}
                                                onClick={() => handleSelection('workoutMode', mode.value)}
                                            >
                                                <input 
                                                    type="radio" 
                                                    name="workoutMode"
                                                    checked={formData.workoutMode === mode.value}
                                                    onChange={() => {}}
                                                />
                                                <label>{mode.label}</label>
                                            </div>
                                        ))}
                                    </div>
                                    {errors.workoutMode && <div className="error-message">{errors.workoutMode}</div>}
                                </div>
                            </div>
                        );
                    case 5:
                        return (
                            <div className="wizard-step">
                                <h2>Dietary Preferences & Health</h2>
                                <div className="input-group">
                                    <label>What are your dietary preferences?</label>
                                    <div className="dietary-options">
                                        {dietaryOptions.map(option => (
                                            <div key={option.value} className="dietary-option-container">
                                                <div 
                                                    className={`dietary-option ${formData.dietaryPreferences.includes(option.value) ? 'selected' : ''}`}
                                                    onClick={() => handleDietaryPreferenceChange(option.value)}
                                                >
                                                    <input 
                                                        type="checkbox" 
                                                        checked={formData.dietaryPreferences.includes(option.value)}
                                                        onChange={() => {}}
                                                    />
                                                    <label>{option.label}</label>
                                                    <div 
                                                        className="dietary-toggle-block"
                                                        onClick={(e) => {
                                                            e.stopPropagation();
                                                            toggleDietarySubOptions(option.value);
                                                        }}
                                                    >
                                                        <i className={`fas fa-chevron-down ${expandedDietaryOptions.includes(option.value) ? 'rotated' : ''}`}></i>
                                                    </div>
                                                </div>
                                                
                                                {expandedDietaryOptions.includes(option.value) && (
                                                    <div className={`dietary-sub-options ${expandedDietaryOptions.includes(option.value) ? 'active' : ''}`}>
                                                        {option.subOptions.map(subOption => (
                                                            <div 
                                                                key={subOption}
                                                                className={`dietary-sub-option ${formData.avoidFoods.includes(subOption) ? 'selected' : ''} ${option.value === 'Health Restrictions' ? 'health-restriction' : ''}`}
                                                                onClick={() => {
                                                                    if (option.value === 'Health Restrictions') {
                                                                        handleHealthConditionChange(subOption);
                                                                    } else {
                                                                        handleAvoidFoodChange(subOption);
                                                                    }
                                                                }}
                                                            >
                                                                <input 
                                                                    type="checkbox" 
                                                                    checked={option.value === 'Health Restrictions' 
                                                                        ? formData.healthConditions.includes(subOption)
                                                                        : formData.avoidFoods.includes(subOption)}
                                                                    onChange={() => {}}
                                                                />
                                                                <label>{subOption}</label>
                                                                {option.value === 'Health Restrictions' && (
                                                                    <div className="health-restriction-desc">
                                                                        If you select this option, your plan will be customized to accommodate this health condition. Please consult with a healthcare professional before starting any new fitness or diet program.
                                                                    </div>
                                                                )}
                                                            </div>
                                                        ))}
                                                    </div>
                                                )}
                                            </div>
                                        ))}
                                    </div>
                                    {errors.dietaryPreferences && <div className="error-message">{errors.dietaryPreferences}</div>}
                                </div>
                                
                                <div className="input-group">
                                    <label>Do you have any health issues that might affect your workout or diet plan?</label>
                                    <div className="workout-mode-options">
                                        <div 
                                            className={`workout-mode-option ${formData.hasHealthIssues === 'yes' ? 'selected' : ''}`}
                                            onClick={() => handleSelection('hasHealthIssues', 'yes')}
                                        >
                                            <input 
                                                type="radio" 
                                                name="hasHealthIssues"
                                                checked={formData.hasHealthIssues === 'yes'}
                                                onChange={() => {}}
                                            />
                                            <label>Yes</label>
                                        </div>
                                        <div 
                                            className={`workout-mode-option ${formData.hasHealthIssues === 'no' ? 'selected' : ''}`}
                                            onClick={() => handleSelection('hasHealthIssues', 'no')}
                                        >
                                            <input 
                                                type="radio" 
                                                name="hasHealthIssues"
                                                checked={formData.hasHealthIssues === 'no'}
                                                onChange={() => {}}
                                            />
                                            <label>No</label>
                                        </div>
                                    </div>
                                    
                                    {formData.hasHealthIssues === 'yes' && (
                                        <div className={`health-issues-options ${formData.hasHealthIssues === 'yes' ? 'active' : ''}`}>
                                            {healthIssuesOptions.map(condition => (
                                                <div 
                                                    key={condition.value}
                                                    className={`health-issue-option ${formData.healthConditions.includes(condition.value) ? 'selected' : ''}`}
                                                    onClick={() => handleHealthConditionChange(condition.value)}
                                                >
                                                    <input 
                                                        type="checkbox" 
                                                        checked={formData.healthConditions.includes(condition.value)}
                                                        onChange={() => {}}
                                                    />
                                                    <label>{condition.label}</label>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                    {errors.healthConditions && <div className="error-message">{errors.healthConditions}</div>}
                                </div>
                                
                                {formData.hasHealthIssues === 'yes' && (
                                    <div className="fitness-description" style={{borderLeftColor: 'var(--danger-color)'}}>
                                        <p style={{color: 'var(--danger-color)'}}>
                                            <i className="fas fa-exclamation-triangle"></i> 
                                            <strong>Important:</strong> If you have any health conditions, please consult with a healthcare professional before starting any new fitness or diet program. The generated plan is not a substitute for professional medical advice.
                                        </p>
                                    </div>
                                )}
                            </div>
                        );
                    case 6:
                        return (
                            <div className="wizard-step">
                                <h2>Review Your Information</h2>
                                <div className="review-container">
                                    <div className="review-section">
                                        <h3><i className="fas fa-bullseye"></i> Fitness Goal</h3>
                                        <p>{goalOptions.find(g => g.value === formData.goal)?.label || formData.goal}</p>
                                    </div>
                                    
                                    <div className="review-section">
                                        <h3><i className="fas fa-user"></i> Personal Information</h3>
                                        <p>Age: {formData.age} years</p>
                                        <p>Weight: {formData.weight} kg</p>
                                        <p>Height: {formData.heightFt} ft {formData.heightIn} in</p>
                                        <p>Body Type: {bodyTypeOptions.find(b => b.value === formData.bodyType)?.label || formData.bodyType}</p>
                                    </div>
                                    
                                    <div className="review-section">
                                        <h3><i className="fas fa-chart-line"></i> Fitness Level</h3>
                                        <p>{fitnessLevelOptions.find(f => f.value === formData.fitnessLevel)?.label || formData.fitnessLevel}</p>
                                    </div>
                                    
                                    <div className="review-section">
                                        <h3><i className="fas fa-dumbbell"></i> Equipment & Workout Mode</h3>
                                        <p>Equipment: {formData.equipment.length > 0 ? formData.equipment.join(', ') : 'None'}</p>
                                        <p>Workout Mode: {workoutModeOptions.find(w => w.value === formData.workoutMode)?.label || formData.workoutMode}</p>
                                    </div>
                                    
                                    <div className="review-section">
                                        <h3><i className="fas fa-utensils"></i> Dietary Preferences</h3>
                                        <p>Preferences: {formData.dietaryPreferences.length > 0 ? formData.dietaryPreferences.join(', ') : 'None'}</p>
                                        {formData.avoidFoods.length > 0 && <p>Avoid: {formData.avoidFoods.join(', ')}</p>}
                                        <p>Health Issues: {formData.hasHealthIssues === 'yes' ? 'Yes' : 'No'}</p>
                                        {formData.hasHealthIssues === 'yes' && formData.healthConditions.length > 0 && (
                                            <p>Conditions: {formData.healthConditions.join(', ')}</p>
                                        )}
                                    </div>
                                </div>
                                
                                {errors.general && <div className="error-message">{errors.general}</div>}
                                
                                <div className="wizard-nav">
                                    <button className="btn-secondary" onClick={handlePrev}>
                                        <i className="fas fa-arrow-left"></i> Previous
                                    </button>
                                    <button className="btn-primary" onClick={handleGeneratePlan} disabled={isLoading}>
                                        {isLoading ? (
                                            <>
                                                <i className="fas fa-spinner fa-spin"></i> Generating...
                                            </>
                                        ) : (
                                            <>
                                                <i className="fas fa-magic"></i> Generate My Plan
                                            </>
                                        )}
                                    </button>
                                </div>
                            </div>
                        );
                    default:
                        return null;
                }
            };
            
            return (
                <div className="plan-selector-wizard">
                    <Header onHistoryClick={handleHistoryClick} />
                    
                    <div className="container">
                        <div className="wizard-header">
                            <h1>Create Your Personalized Fitness Plan</h1>
                            <p>Answer a few questions and we'll generate a customized workout and diet plan just for you.</p>
                        </div>
                        
                        <div className="wizard-container">
                            <div className="progress-bar">
                                <div className="progress-line" style={{ width: `${progress}%` }}></div>
                                {[...Array(totalSteps)].map((_, i) => (
                                    <div key={i} className={`step ${i + 1 < step ? 'completed' : i + 1 === step ? 'active' : ''}`}>
                                        <div className="step-icon">
                                            {i + 1 < step ? <i className="fas fa-check"></i> : i + 1}
                                        </div>
                                        <span>Step {i + 1}</span>
                                    </div>
                                ))}
                            </div>
                            
                            {renderStep()}
                            
                            {step < totalSteps && (
                                <div className="wizard-nav">
                                    <button className="btn-secondary" onClick={handlePrev} disabled={step === 1}>
                                        <i className="fas fa-arrow-left"></i> Previous
                                    </button>
                                    <button className="btn-primary" onClick={handleNext}>
                                        Next <i className="fas fa-arrow-right"></i>
                                    </button>
                                </div>
                            )}
                        </div>
                        
                        {generatedPlan && (
                            <div className="log-plan-section">
                                <h3>Your Personalized Plan</h3>
                                <p>Review your plan below and log it to your history for future reference.</p>
                                <div className="wizard-nav">
                                    <button className="btn-secondary" onClick={() => setGeneratedPlan(null)}>Back to Form</button>
                                    <button 
                                        className={`btn-primary ${isPlanLogged ? 'logged-animation' : ''}`} 
                                        onClick={handleLogPlan} 
                                        disabled={isLogging || isPlanLogged}
                                    >
                                        {isLogging ? 'Logging...' : isPlanLogged ? 'Plan Logged!' : 'Log Plan'}
                                    </button>
                                </div>
                                <GeneratedPlan plan={generatedPlan} planRef={planRef} />
                            </div>
                        )}
                    </div>
                    
                    <div className="footer">
                        <p>Â© 2023 Elite Performance. All rights reserved.</p>
                    </div>
                    
                    <HistoryModal isVisible={showHistoryModal} onClose={closeHistoryModal} />
                </div>
            );
        };
        
        // Main App Component
        const App = () => {
            const [smashEvents, setSmashEvents] = useState([]);
            
            useEffect(() => {
                // Initialize particle background
                const canvas = document.getElementById('particle-background');
                const ctx = canvas.getContext('2d');
                
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
                
                const particles = [];
                const particleCount = 100;
                
                class Particle {
                    constructor() {
                        this.x = Math.random() * canvas.width;
                        this.y = Math.random() * canvas.height;
                        this.size = Math.random() * 3 + 1;
                        this.speedX = Math.random() * 1 - 0.5;
                        this.speedY = Math.random() * 1 - 0.5;
                        this.color = `rgba(0, 255, 255, ${Math.random() * 0.5 + 0.1})`;
                    }
                    
                    update() {
                        this.x += this.speedX;
                        this.y += this.speedY;
                        
                        if (this.x < 0 || this.x > canvas.width) this.speedX *= -1;
                        if (this.y < 0 || this.y > canvas.height) this.speedY *= -1;
                    }
                    
                    draw() {
                        ctx.fillStyle = this.color;
                        ctx.beginPath();
                        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                        ctx.fill();
                    }
                }
                
                const init = () => {
                    for (let i = 0; i < particleCount; i++) {
                        particles.push(new Particle());
                    }
                };
                
                const animate = () => {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    
                    for (let i = 0; i < particles.length; i++) {
                        particles[i].update();
                        particles[i].draw();
                    }
                    
                    requestAnimationFrame(animate);
                };
                
                init();
                animate();
                
                // Handle window resize
                const handleResize = () => {
                    canvas.width = window.innerWidth;
                    canvas.height = window.innerHeight;
                };
                
                window.addEventListener('resize', handleResize);
                
                return () => {
                    window.removeEventListener('resize', handleResize);
                };
            }, []);
            
            const handleSmash = (e) => {
                const rect = e.currentTarget.getBoundingClientRect();
                const x = rect.left + rect.width / 2;
                const y = rect.top + rect.height / 2;
                setSmashEvents(prev => [...prev, { x, y }]);
            };
            
            return (
                <>
                    <LoadingScreen />
                    <CustomCursor />
                    <AmbientGlow />
                    <SmashEffectContainer smashEvents={smashEvents} />
                    <PlanSelector />
                </>
            );
        };
        
        // Render the App
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>